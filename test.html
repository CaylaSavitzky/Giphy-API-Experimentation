
<html>
	<head>
		<script>
			var api_key = "ZiWvaBkvD0BNtOACTwJelb1CDZXJGWyE";
		</script>
	</head>
	<body>
	<!--
		<img src = "http://media2.giphy.com/media/FiGiRei2ICzzG/giphy.gif">

		<iframe width="420" height="315"
			src="https:\/\/giphy.com\/embed\/pjnfNhaFmkhxu">
		</iframe>
	-->
	<div id = "gifs_container">


	</div>


		<script>
			var search_results = [];
			var gifs_container = document.getElementById("gifs_container");
			var gif_src_regex = /original":{("url":".*?")/g;
			var gif_src_array = []
			function cleanurl (url)
			{
				var backslash_index = url.indexOf('\\');
			      while (backslash_index > -1) {
			      	url = url.slice(0,url.indexOf('\\')) + url.slice(url.indexOf('\\')+1);
			      	backslash_index = url.indexOf('\\');
			      }
			    return url;
			}
			class Image {
				constructor(url = "", width = 0, height = 0, size = 0, frames = "", mp4 = "", mp4_size = 0, webp = "", webp_size = 0){
					
					this.url = url;
                	this.width = width;
                	this.height = height;
	                this.size = size;
    	            this.frames = frames;
        	        this.mp4 = mp4;
            	    this.mp4_size = mp4_size;
	                this.webp = webp;
    	            this.webp_size = webp_size;
				}
			}
			class Image_Holder{
				constructor(fixed_height = null,
	            fixed_height_still = null,
	            fixed_height_downsampled = null,
	            fixed_width = null,
	            fixed_width_still = null,
	            fixed_width_downsampled = null,
	            fixed_height_small = null,
	            fixed_height_small_still = null,
	            fixed_width_small = null,
	            fixed_width_small_still = null,
	            downsized = null,
	            downsized_still = null,
	            downsized_large = null,
	            original = null,
                original_still = null)
                {
					this.fixed_height = fixed_height;
		            this.fixed_height_still = fixed_height_still;
		            this.fixed_height_downsampled = fixed_height_downsampled;
		            this.fixed_width = fixed_width;
		            this.fixed_width_still = fixed_width_still;
		            this.fixed_width_downsampled = fixed_width_downsampled;
		            this.fixed_height_small = fixed_height_small;
		            this.fixed_height_small_still = fixed_height_small_still;
		            this.fixed_width_small = fixed_width_small;
		            this.fixed_width_small_still = fixed_width_small_still;
		            this.downsized = downsized;
		            this.downsized_still = downsized_still;
		            this.downsized_large = downsized_large;
		            this.original = original;
	           	    this.original_still = original_still;
	            }
			}

			class Gif {
				constructor(type = '', id = '', slug = '', url = '', bitly_gif_url = '', bitly_url = '', embed_url = '', username = '', source = '', rating = '', caption = '', content_url = '', source_tld = '', source_post_url = '', is_sticker = '0', import_datetime = '', trending_datetime = '', images = [], title = '',){
					
					this.type = type;
			        this.id = id;
			        this.slug = slug;
			        this.url = url;
			        this.bitly_gif_url = bitly_gif_url;
			        this.bitly_url = bitly_url;
			        this.embed_url = embed_url;
			        this.username = username;
			        this.source = source;
			        this.rating = rating;
			        this.caption = caption;
			        this.content_url = content_url;
			        this.source_tld = source_tld;
			        this.source_post_url = source_post_url;
			        this.is_sticker = is_sticker;
			        this.import_datetime = import_datetime;
			        this.trending_datetime = trending_datetime;
			        this.images = images;
			        this.title = title;
				}
			}
			var a;
			var ns;
			var ne;
			var li;

			var xhr = new XMLHttpRequest();
			xhr.open("GET", "http://api.giphy.com/v1/gifs/search?q=kitten&api_key=" + api_key+ "&limit=5", true);
			xhr.onload = function (e) {
			  if (xhr.readyState === 4) {
			    if (xhr.status === 200) {

			    	data = xhr.responseText;
			    	ns = 17;
			    	ne = ns;
			    	li = [];
			    	/*
			    	for (var i = 0; i < 16; i++)
			    	{
			    		ne = data.indexOf('"',ne+1);
				    	li.push(data.slice(ns+1,ne));
				    	if (i == 12)
				    	{
				    		ns = ne;
					    	ne = data.indexOf('"',ne+1);
					    	ns = ne;
					    	ne = data.indexOf('"',ne+1);
					    	ns = ne;
				    	}
				    	else
				    	{
				    		ns = ne;
					    	ne = data.indexOf('"',ne+1);
					    	ns = ne;
					    	ne = data.indexOf('"',ne+1);
					    	ns = ne;
					    	ne = data.indexOf('"',ne+1);
					    	ns = ne;
				    	}
			    	}*/

			    	
			    	data = xhr.responseText;
			    	ns = 0;
			    	ne = ns;
			    	li = [];

			    	function object_parse (li, ns = 0, ne = 0)
			    	{
				    	while (ns != -1 & ne != -1)
				    	{	
				    		var nb = data.indexOf("{",ns);
				    		ns = data.indexOf(":",ns);
				    		if ("{" == data[ns+1] || "{" == data[ns+2] ){
				    			ns = ns+2
				    			l = [];
				    			console.log(li)
				    			var temp = object_parse(l,ns,ne);
				    			ns = temp[0];
				    			ne = temp[1];
				    			li.push(l);
				    		}
				    		/* something with 
				    		|| "{" == data[data.indexOf(",",ne) +1]
				    		*/

				    		ne = ns;
				    		nb = data.indexOf("}",ns);
				    		ne = data.indexOf(",",ne);
				    		if (nb < ne)
				    		{
				    			ne = nb;
				    			var l = data.slice(ns+1,ne);
					    		if(l[0] == '"')
					    		{
					    			l = l.substr(1);
					    		}
					    		if(l[l.length-1] == '"')
					    		{
					    			l = l.slice(0,l.length-1);
					    		}

					    		li.push(l);
					    		ns = ne;
					    		if (ns == -1 || ne == -1)
					    		{
					    			ns = data.length;
					    			ne = data.length;
					    			console.log("end")
					    		}
					    		return [ns+1,ne+1];
				    		}

				    		var l = data.slice(ns+1,ne);
				    		if(l[0] == '"')
				    		{
				    			l = l.substr(1);
				    		}
				    		if(l[l.length-1] == '"')
				    		{
				    			l = l.slice(0,l.length-1);
				    		}

				    		li.push(l);
				    		ns = ne;
				    	}
				    	return [ns+1,ne+1];
				    }
				    object_parse(li,ns,ne);
			    	


	/*
	!
	!
	!
	!
	COLLECT AND FORMAT IMAGES & METADATA
	!
	!
	!
	!
	*/

			    	/* GATHER SEARCH RESULTS AND CREATE ARRAY OF ORIGINAL GIPH URLS */
			      search_results.push(xhr.responseText);
			      gif_src_array.push.apply(gif_src_array, search_results[0].match(gif_src_regex));

			        /* CLEAN ARRAY SO EACH ELEMENT IS FORMATTED: "https://.... ... ... .gif" */
			      temp_array = [];
			      gif_src_array.forEach(function(element) {
			      	temp_array.push(cleanurl(element.substr(17)));
			      });
			      gif_src_array = temp_array;

	/*
	!
	!
	!
	POST GIPHS
	!
	!
	!
	*/

			        /* POST GIPHS IN SUITABLE FASHION */
			      gif_src_array.forEach(function(element){
					  gifs_container.innerHTML = gifs_container.innerHTML + '<img src=' + element + '>';
					});




			    } else {
			      console.error(xhr.statusText);
			    }
			  }
			};
			xhr.onerror = function (e) {
			  console.error(xhr.statusText);
			};
			xhr.send(null);

			

			/*
			Regex for finding original gif
			(/original":{("url":".*?"),"width":"([0-9]*)","height":"([0-9]*)","size":"([0-9]*)/g)
			*/
		</script>
	</body>
</html>