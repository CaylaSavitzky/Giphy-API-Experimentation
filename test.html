
<html>
	<head>
		<script>
			var api_key = "ZiWvaBkvD0BNtOACTwJelb1CDZXJGWyE";
		</script>
		<style>
			body {
				background:black;
				display: flex;
				align-items: flex-start;
				justify-content: center;
				flex-wrap:wrap;
			}
			img, iframe {
				border: 1px solid 777;
				width:200px;
				margin: 15px 0 15px 0;
			}

			.giphs_container {
				margin:0 15px 0 15px;
				width:200px;
			}

		</style>
		<script>
			var search_results = [];
			var giphs_container = document.getElementsByClassName("giphs_container");
			var giph_src_original_url_regex = /original":{("url":".*?")/g;
			var giph_src_original_regex = /original":{.*?}/g;
			var search_items = "kittens";
			var view_number = 25;
			var view_loads = 1;

			var giph_src_array = []
			function cleanurl (url)
			{
				var backslash_index = url.indexOf('\\');
			      while (backslash_index > -1) {
			      	url = url.slice(0,url.indexOf('\\')) + url.slice(url.indexOf('\\')+1);
			      	backslash_index = url.indexOf('\\');
			      }
			    return url;
			}

			function between_strings(element, start_item,end_item)
			{
				var start_loc = element.indexOf(start_item) + start_item.length;
			    var end_loc = element.indexOf(end_item,start_loc);
			    return element.slice(start_loc,end_loc);
			}

			function test_resize_need (){
				var two_col = 245;
			  	var col_width = 230;
			  	var col_number = 1;
			  	var screenwidth = window.innerWidth;
			  	var next_total = two_col + col_number*col_width;
			  	while (screenwidth>next_total){
					col_number++;
				  	next_total = two_col + col_number*col_width;
				  	if (screenwidth < next_total){
				  		return col_number;
				  	}
				  	
				}
			}

			function set_giphs_container (){
			  	var body = document.body;
			  	body.innerHTML = '';
			  	var two_col = 245;
			  	var col_width = 230;
			  	var col_number = 1;
			  	var screenwidth = window.innerWidth;
			  	var next_total = two_col + col_number*col_width;
			  	while (screenwidth>next_total){
					col_number++;
				  	next_total = two_col + col_number*col_width;
				  	if (screenwidth < next_total){
				  		for (i = 0; i < col_number; i++){
				  			body.innerHTML = body.innerHTML + '<div class = "giphs_container"></div>';
				  		}
				  	}
				}
				if (col_number == 1){
				  		for (i = 0; i < col_number; i++){
				  			body.innerHTML = body.innerHTML + '<div class = "giphs_container"></div>';
				  		}
				  	}
			  	var giphs_containers = document.getElementsByClassName("giphs_container");
			  	return giphs_containers;
			}

			function distribute_giphs (giph_details_array,giphs_container){
		  		var i = 0;
		  		var giph_columns = giphs_container.length;
		        /* POST GIPHS IN SUITABLE FASHION */
		        giph_details_array.forEach(function(element){
					giphs_container[i%giph_columns].innerHTML = giphs_container[i%giph_columns].innerHTML + '<img src=' + element[2] + '>';
					i++;
				});	
			  }

		  	function resize_function (){
				if (test_resize_need() != giphs_container.length){
				  	giphs_container = set_giphs_container();
					distribute_giphs(giph_details_array,giphs_container);
					console.log('resize');
				}
		  	}

			function giph_request(items,number){
				search_request = "http://api.giphy.com/v1/gifs/search?q="+search_items+"&api_key=" + api_key+ "&limit="+view_number;
				var xhr = new XMLHttpRequest();
				xhr.open("GET", search_request, true);
				xhr.onload = function (e) {
				  if (xhr.readyState === 4) {
				    if (xhr.status === 200) {

		/*	COLLECT AND FORMAT IMAGES & METADATA*/

				    	/* GATHER SEARCH RESULTS AND CREATE ARRAY OF ORIGINAL GIPH URLS */
				      search_results.push(xhr.responseText);
				      giph_src_array.push.apply(giph_src_array, search_results[0].match(giph_src_original_regex));

				        /* CLEAN ARRAY SO EACH ELEMENT IS FORMATTED: "https://.... ... ... .giph" */

				      giph_details_array = []
				      giph_src_array.forEach(function(element) {
				      	element_details = [];
				      	element_details.push(cleanurl(between_strings(element,'height":"','"')));
				      	element_details.push(cleanurl(between_strings(element,'width":"','"')));
				      	element_details.push(cleanurl(between_strings(element,'url":"','"')));
				      	element_details.push(cleanurl(between_strings(element,'mp4":"','"')));
				      	giph_details_array.push(element_details);
				      });

		/*	POST GIPHS	*/

					  resize_function();
					  console.log(giph_details_array);


				    } else {
				      console.error(xhr.statusText);
				    }
				  }
				};
				xhr.onerror = function (e) {
				  console.error(xhr.statusText);
				};
				xhr.send(null);
			}

			giph_request();
			

			/*
			Regex for finding original giph
			(/original":{("url":".*?"),"width":"([0-9]*)","height":"([0-9]*)","size":"([0-9]*)/g)
			*/
		</script>
	</head>
	<body onresize = "resize_function()">

	</body>
</html>